<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <title>Fiziksel Envanter</title>

    <link rel="stylesheet" type="text/css" href="styles.css" />

    <style>
        /* Container Styles */
        .panel-container {
            display: flex;
            padding: 10px;
            margin: auto;
            width: 80%;
            justify-content: center;
            font-size: 10px;
        }

        .left-panel {
            display: flex;
            flex-wrap: wrap;
            justify-content: flex-end;
        }

        .right-panel {
            width: 500px;
            padding-top: 10px;
        }

        /* Panel Styles */
        .panel {
            border: 1px solid #ddd;
            padding: 2px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            width: 190px;
            height: 170px;
            margin: 10px 5px 0 0;
        }

        .buttons-panel {
            background-color: transparent;
            border: none;
            box-shadow: none;
        }

        .right-panel .panel {
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 0 5px 0 0;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            width: 100%;
            height: 365px;
            margin-bottom: 10px;
        }

        .checkbox-panel {
            max-height: 115px;
            overflow-y: auto;
        }

        .right-panel .checkbox-panel {
            max-height: 290px;
            margin-left: 10px;
        }

        /* Input Styles */
        .search-input {
            width: 90%;
            padding: 5px;
            margin: 0;
            margin-bottom: 2px;
            font-size: 10px;
            box-sizing: border-box;
        }

        .right-panel .search-input {
            margin-top: 5px;
            margin-bottom: 5px;
            margin-left: 10px;
        }

        .dropdown {
            width: 90%;
            padding: 5px;
            margin-top: 10px;
            margin-left: 10px;
            box-sizing: border-box;
        }

        .checkbox-content {
            margin: 0;
        }

        /* Table Styles */
        #score-table {
            border: none;
            border-collapse: collapse;
            margin-top: 5px;
            width: 100%;
        }

        #score-table td {
            font-weight: bold;
            padding: 8px;
            text-align: left;
            border: none;
        }

        .table-container {
            width: 90%;
            overflow-y: auto;
            align-items: center;
            justify-content: center;
            margin: auto;
            font-size: 10px;
        }

        .content-table {
            border-collapse: collapse;
            font-size: 10px;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        th {
            cursor: pointer;
            background-color: #f2f2f2;
        }

        th:not(:first-child) {
            width: auto;
            min-width: 170px;
        }

        /* Button Styles */
        .button-container {
            display: flex;
            justify-content: center;
        }

        .button-container .button {
            background-color: #ccc;
            color: black;
        }

        .button-container .active {
            background-color: var(--primary-color);
            color: white;
        }

        .panel-button {
            margin-top: 5px;
            margin-left: 15px;
            padding: 10px 0px;
            width: 150px;
            border-radius: 3px;
        }

        /* Icon Styles */
        .edit-icon {
            min-width: 16px;
            background-image: url('edit.png');
            background-repeat: no-repeat;
            background-size: 70%;
            background-position: center;
            cursor: pointer;
        }

        /* Pagination Styles */
        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            margin-bottom: 20px;
        }

        .page-link {
            background-color: white;
            display: inline-block;
            padding: 8px;
            margin: 0 4px;
            text-decoration: none;
            cursor: pointer;
            color: #333;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .page-link.active {
            background-color: var(--primary-color);
            color: white;
        }

        /* Heading Styles */
        h5 {
            margin: 0 0 10px;
            font-size: 10px;
            color: #333;
        }

        h2 {
            margin-bottom: 5px;
        }
    </style>

</head>

<body>
    <form id="form1" runat="server">
        <div class="header">
            <div>
                <h1 class="baslik" id="baslik" runat="server">Fiziksel Envanter</h1>
            </div>
            <div id="logo"></div>

        </div>
        <div id="panel-container" class="panel-container">
            <div class="left-panel">
                <div class="panel filter-panel">
                    <h5>Adı</h5>
                    <input type="text" placeholder="Search for Filtering" class="search-input">
                    <div class="checkbox-panel"></div>
                </div>
                <div class="panel filter-panel">
                    <h5>Üretici Firma</h5>
                    <input type="text" placeholder="Search for Filtering" class="search-input">
                    <div class="checkbox-panel"></div>
                </div>
                <div class="panel filter-panel">
                    <h5>Model</h5>
                    <input type="text" placeholder="Search for Filtering" class="search-input">
                    <div class="checkbox-panel"></div>
                </div>
                <div class="panel filter-panel">
                    <h5>Kapsam-BBVA Metrics</h5>
                    <input type="text" placeholder="Search for Filtering" class="search-input">
                    <div class="checkbox-panel"></div>
                </div>
                <div class="panel filter-panel">
                    <h5>Enviroment</h5>
                    <input type="text" placeholder="Search for Filtering" class="search-input">
                    <div class="checkbox-panel"></div>
                </div>
                <div class="panel filter-panel">
                    <h5>Özel Durumu</h5>
                    <input type="text" placeholder="Search for Filtering" class="search-input">
                    <div class="checkbox-panel"></div>
                </div>
                <div class="panel filter-panel">
                    <h5>İşletim Sistemi</h5>
                    <input type="text" placeholder="Search for Filtering" class="search-input">
                    <div class="checkbox-panel"></div>
                </div>
                <div class="panel">
                    <table id="score-table">
                        <tr>
                            <td>Total Cpu Socket</td>
                            <td id="soket-count">0</td>
                        </tr>

                        <tr>
                            <td>Total Core</td>
                            <td id="core-count">0</td>
                        </tr>
                        <tr>
                            <td>Total Memory</td>
                            <td id="memory-count">0</td>
                        </tr>
                    </table>
                </div>
                <div class="panel" style="text-align: center;">
                    <div>
                        <h2>Rows per Page</h2>
                        <div class="button-container">
                            <div class="button active" onclick="setRowsPerPage(this)">10</div>
                            <div class="button" onclick="setRowsPerPage(this)">20</div>
                            <div class="button" onclick="setRowsPerPage(this)">50</div>
                        </div>
                    </div>
                    <h2>Row Count</h2>
                    <h2 id="row-count">0</h2>

                </div>
                <div class="panel buttons-panel">
                    <button id="reset-button" class="panel-button" type="button">Reset Filters</button>
                    <button id="add-button" class="panel-button">Add a new Machine</button>
                    <button id="chart-button" class="panel-button" type="button">Show as Pie Chart</button>
                </div>
            </div>
            <div class="right-panel">
                <div class="panel filter-panel">
                    <h5 style="display:none;">Select Extra Column</h5>
                    <select id="column-dropdown" class="dropdown">
                        <option>Select Extra Column</option>
                    </select>
                    <input style="display:none;" type="text" placeholder="Search for Filtering" class="search-input">

                    <div class="checkbox-panel"></div>
                </div>
            </div>




        </div>
        <div class="table-container">
            <table id="contentTable" class="content-table" runat="server">
                <thead>
                    <tr>
                        <th></th>
                        <th>Adı</th>
                        <th>Seri NO</th>
                        <th>Açıklama</th>
                        <th>Üretici Firma</th>
                        <th>Model</th>
                        <th>CPU Soket</th>
                        <th>CPU Core</th>
                        <th>Toplam Core</th>
                        <th>Memory</th>
                        <th>Cihaz Tipi</th>
                        <th>Hall</th>
                        <th>Row</th>
                        <th>Rack</th>
                        <th>Blade Şasi</th>
                        <th>Domain Bilgisi</th>
                        <th>Enviroment</th>
                        <th>Firma</th>
                        <th>Sahiplik</th>
                        <th>Lokasyon</th>
                        <th>Kapsam-BBVA Metrics</th>
                        <th>Cluster</th>
                        <th>İşletim Sistemi</th>
                        <th>Sorumlu Grup</th>
                        <th>Satın Alma Tarihi</th>
                        <th>Planlanan Devreden Çıkarma Tarihi</th>
                        <th>Bakım Başlangıç Tarihi</th>
                        <th>Bakım Bitiş Tarihi</th>
                        <th>Özel Durumu</th>
                        <th>Support</th>
                    </tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
        <div class="pagination" id="pagination"></div>

        <footer>
            <p class="footer">© 2024 - Cloud United Team</p>
        </footer>

        <script>
            const MAX_PAGE = 10;
            let ROWS_PER_PAGE = 10;
            let CURRENT_PAGE = 1;
            let data = [];
            let ascending = true;
            let filteredData = [];

            function sortDatas(index) {
                filteredData.sort((a, b) => {
                    let aValue = a[Object.keys(a)[index]];
                    let bValue = b[Object.keys(b)[index]];

                    if (!isNaN(aValue) && !isNaN(bValue)) {
                        return ascending ? aValue - bValue : bValue - aValue;
                    }

                    if (index === 9) {
                        if (aValue == "-") return 1;
                        if (bValue == "-") return -1;
                        aValue = new Date(aValue.trim());
                        bValue = new Date(bValue.trim());
                        return ascending ? aValue - bValue : bValue - aValue;
                    }
                    return ascending ? aValue.trim().localeCompare(bValue.trim()) : bValue.trim().localeCompare(aValue.trim());
                });
                CURRENT_PAGE = 1;
                renderPage(CURRENT_PAGE);
                renderPagination();
            }

            function add1000RowstoData() {
                for (let i = 0; i < 1000; i++) {
                    data.push({
                        "": "",
                        "Adı": "Adı" + i,
                        "Seri NO": "Seri NO" + i,
                        "Açıklama": "Açıklama" + i,
                        "Üretici Firma": "Üretici Firma" + i,
                        "Model": "Model" + i,
                        "CPU Soket": i % 2,
                        "CPU Core": i,
                        "Toplam Core": i,
                        "Memory": i,
                        "Cihaz Tipi": "Cihaz Tipi" + i,
                        "Hall": "Hall" + i,
                        "Row": "Row" + i,
                        "Rack": "Rack" + i,
                        "Blade Şasi": "Blade Şasi" + i,
                        "Domain Bilgisi": "Domain Bilgisi" + i,
                        "Enviroment": "Enviroment" + i,
                        "Firma": "Firma" + i,
                        "Sahiplik": "Sahiplik" + i,
                        "Lokasyon": "Lokasyon" + i,
                        "Kapsam-BBVA Metrics": "Kapsam-BBVA Metrics" + i,
                        "Cluster": "Cluster" + i,
                        "İşletim Sistemi": "İşletim Sistemi" + i,
                        "Sorumlu Grup": "Sorumlu Grup" + i,
                        "Satın Alma Tarihi": "Satın Alma Tarihi" + i,
                        "Planlanan Devreden Çıkarma Tarihi": "Planlanan Devreden Çıkarma Tarihi" + i,
                        "Bakım Başlangıç Tarihi": "Bakım Başlangıç Tarihi" + i,
                        "Bakım Bitiş Tarihi": "Bakım Bitiş Tarihi" + i,
                        "Özel Durumu": "Özel Durumu" + i,
                        "Support": "Support" + i
                    });
                }
            }

            function renderPage(pageNumber) {
                const start = (pageNumber - 1) * ROWS_PER_PAGE;
                const end = start + ROWS_PER_PAGE;
                const paginatedData = filteredData.slice(start, end);

                const tableBody = document.getElementById('tableBody');
                tableBody.innerHTML = '';

                paginatedData.forEach(row => {
                    const tr = document.createElement('tr');
                    for (const cellData of Object.values(row)) {
                        const td = document.createElement('td');
                        td.textContent = cellData;
                        tr.appendChild(td);
                    }
                    tableBody.appendChild(tr);
                });
                setEditIcons();
                setCounters();
            }

            function renderPagination() {
                const totalPages = Math.ceil(filteredData.length / ROWS_PER_PAGE);
                const paginationDiv = document.getElementById('pagination');
                paginationDiv.innerHTML = '';

                let startPage = Math.max(1, CURRENT_PAGE - Math.floor(MAX_PAGE / 2));
                let endPage = Math.min(totalPages, CURRENT_PAGE + Math.floor(MAX_PAGE / 2));

                if (endPage - startPage < MAX_PAGE) {
                    if (startPage === 1) {
                        endPage = Math.min(totalPages, startPage + MAX_PAGE - 1);
                    } else if (endPage === totalPages) {
                        startPage = Math.max(1, endPage - MAX_PAGE + 1);
                    }
                }

                for (let i = startPage; i <= endPage; i++) {
                    const button = document.createElement('button');
                    button.textContent = i;
                    button.className = 'page-link';
                    if (i === CURRENT_PAGE) {
                        button.classList.add('active');
                    }
                    button.addEventListener('click', () => {
                        CURRENT_PAGE = i;
                        renderPage(CURRENT_PAGE);
                        renderPagination();
                    });
                    paginationDiv.appendChild(button);
                }
            }

            function initializeTable() {
                add1000RowstoData();
                filteredData = data;
                document.querySelectorAll(".filter-panel").forEach(column => {
                    generateColumnCheckboxes(column);
                });
                renderPagination();
                addOptionsDropdown();
                sortDatas(0);
            }

            function getColumnIndex(columnName) {
                const contentTable = document.getElementById("contentTable");
                return Array.from(contentTable.rows[0].cells).findIndex(cell => cell.innerText.trim() === columnName);
            }

            function setRowsPerPage(selectedButton) {
                const buttons = document.querySelector(".button-container").querySelectorAll('.button');
                buttons.forEach(button => button.classList.remove('active'));
                selectedButton.classList.add('active');
                ROWS_PER_PAGE = selectedButton.textContent;
                CURRENT_PAGE = 1;
                renderPage(CURRENT_PAGE);
            }

            function generateColumnCheckboxes(dropdownContent) {
                const columnIndex = getColumnIndex(dropdownContent.querySelector("h5").textContent);
                const checkboxesDiv = dropdownContent.querySelector(".checkbox-panel");
                if (columnIndex === -1) return;

                checkboxesDiv.querySelectorAll("div").forEach(div => {
                    const checkbox = div.querySelector("input[type='checkbox']");
                    if (!checkbox.checked) {
                        div.remove();
                    }
                });

                const values = [...new Set(filteredData.map(row => row[Object.keys(row)[columnIndex]].toString().trim()))];
                values.sort((a, b) => {
                    if (!isNaN(a) && !isNaN(b)) {
                        return ascending ? a - b : b - a;
                    }
                    if (a == null) return -1;
                    if (b == null) return 1;
                    return ascending ? a.localeCompare(b) : b.localeCompare(a);
                });

                const fragment = document.createDocumentFragment();
                values.forEach(value => {
                    if (checkboxesDiv.querySelector(`input[value='${value}']`)) return;

                    const div = document.createElement("div");
                    const checkbox = document.createElement("input");
                    checkbox.type = "checkbox";
                    checkbox.value = value;
                    checkbox.addEventListener("change", () => {
                        filterTable(checkbox);
                    });

                    const label = document.createElement("label");
                    label.textContent = value;

                    div.appendChild(checkbox);
                    div.appendChild(label);
                    div.appendChild(document.createElement("br"));
                    fragment.appendChild(div);
                });
                checkboxesDiv.appendChild(fragment);
            }

            function filterTable(checkbox) {
                filteredData = data;
                const columns = document.querySelectorAll(".filter-panel");
                columns.forEach(column => {
                    const checkboxes = column.querySelectorAll("input[type='checkbox']:checked");
                    if (checkboxes.length === 0) return;
                    const columnIndex = getColumnIndex(column.querySelector("h5").textContent);
                    const checkboxesValues = Array.from(checkboxes).map(checkbox => checkbox.value);
                    filteredData = filteredData.filter(row => checkboxesValues.includes(row[Object.keys(row)[columnIndex]].toString().trim()));
                });

                columns.forEach(column => {
                    if (!checkbox || column !== checkbox.closest(".filter-panel")) {
                        generateColumnCheckboxes(column);
                    }
                });

                CURRENT_PAGE = 1;
                renderPage(CURRENT_PAGE);
                renderPagination();
            }

            function searchCheckboxes(searchInput) {
                const filter = searchInput.value.toUpperCase();
                const checkboxesDiv = searchInput.parentElement.querySelector(".checkbox-panel");
                const divs = checkboxesDiv.getElementsByTagName("div");
                for (let i = 0; i < divs.length; i++) {
                    const label = divs[i].getElementsByTagName("label")[0];
                    const txtValue = label.textContent || label.innerText;
                    divs[i].style.display = txtValue.toUpperCase().indexOf(filter) > -1 ? "" : "none";
                }
            }

            function setEditIcons() {
                const table = document.getElementById('contentTable');
                const rows = table.querySelectorAll('tbody tr');
                rows.forEach(row => {
                    const cell = row.querySelectorAll('td')[0];
                    cell.classList.add('edit-icon');
                    cell.addEventListener('click', () => {
                        window.location.href = "edit.aspx?name=" + row.querySelectorAll('td')[1].innerText;
                    });
                });
            }

            function calculateTotalValues(columnIndex) {
                return filteredData.reduce((total, row) => total + parseInt(row[Object.keys(row)[columnIndex]]), 0);
            }

            function setCounters() {
                document.getElementById('row-count').textContent = filteredData.length;
                document.getElementById('soket-count').textContent = calculateTotalValues(6);
                document.getElementById('core-count').textContent = calculateTotalValues(7);
                document.getElementById('memory-count').textContent = calculateTotalValues(9);
            }

            function handleDropdownChange() {
                const selectedColumn = document.getElementById('column-dropdown').value;
                document.querySelector('.right-panel h5').textContent = selectedColumn;
                const input = document.querySelector('.right-panel input[type="text"]');
                const checkboxesDiv = document.querySelector('.right-panel .checkbox-panel');
                checkboxesDiv.innerHTML = '';
                input.style.display = selectedColumn === "Select Extra Column" ? "none" : "block";
                filterTable();
            }

            function addOptionsDropdown() {
                const dropdown = document.getElementById('column-dropdown');
                dropdown.innerHTML = '';
                const firstOption = document.createElement('option');
                firstOption.value = "Select Extra Column";
                firstOption.textContent = "Select Extra Column";
                dropdown.appendChild(firstOption);

                const contentTable = document.getElementById('contentTable');
                contentTable.querySelectorAll('th').forEach(column => {
                    const columnName = column.innerText.trim();
                    const excludedColumns = ["", "Adı", "Üretici Firma", "Kapsam-BBVA Metrics", "Enviroment", "Özel Durumu", "İşletim Sistemi", "Model"];
                    if (!excludedColumns.includes(columnName)) {
                        const option = document.createElement('option');
                        option.value = columnName;
                        option.textContent = columnName;
                        dropdown.appendChild(option);
                    }
                });
            }

            document.addEventListener('DOMContentLoaded', () => {
                document.querySelectorAll("th").forEach((th, index) => {
                    th.addEventListener('click', () => {
                        ascending = !ascending;
                        sortDatas(index);
                    });
                });

                document.getElementById('reset-button').addEventListener('click', (event) => {
                    event.preventDefault();
                    document.querySelectorAll("input[type='checkbox']").forEach(checkbox => checkbox.checked = false);
                    document.querySelectorAll("input[type='text']").forEach(input => input.value = "");
                    ascending = true;
                    filterTable();
                    sortDatas(0);
                });

                document.getElementById('add-button').addEventListener('click', (event) => {
                    event.preventDefault();
                    window.location.href = 'create.aspx';
                });

                document.getElementById('column-dropdown').addEventListener('change', handleDropdownChange);

                document.querySelectorAll('.search-input').forEach(input => {
                    input.addEventListener('keyup', () => {
                        searchCheckboxes(input);
                    });
                });
                initializeTable();
            });
        </script>
    </form>

</body>

</html>
