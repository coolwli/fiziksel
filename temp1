$excel = New-Object -ComObject Excel.Application
$excel.Visible = $false
$filePath = "C:\dosya_yolu\dosya_adı.xlsx"
$workbook = $excel.Workbooks.Open($filePath)

try {
    # İkinci sayfayı al
    $worksheet2 = $workbook.Sheets.Item(2)
    $usedRange2 = $worksheet2.UsedRange
    $rows2 = $usedRange2.Rows

    $data = @()

    foreach ($row in $rows2) {
        $rowData = @(
            $row.Cells.Item(3).Text,  # C sütunu
            $row.Cells.Item(4).Text,  # D sütunu
            $row.Cells.Item(5).Text,  # E sütunu
            $row.Cells.Item(6).Text   # F sütunu
        )
        $data += New-Object PSObject -property @{
            C = $rowData[0]
            D = $rowData[1]
            E = $rowData[2]
            F = $rowData[3]
        }
    }

    # Dördüncü sayfayı al ve C sütunundaki isme göre 9. sütun verisini al
    $worksheet4 = $workbook.Sheets.Item(4)
    $usedRange4 = $worksheet4.UsedRange
    $rows4 = $usedRange4.Rows

    $namesData = @{}
    foreach ($row in $rows4) {
        $key = $row.Cells.Item(3).Text  # C sütunu
        $value = $row.Cells.Item(9).Text # I sütunu (9. sütun)
        if ($key -and $value) {
            $namesData[$key] = $value
        }
    }

    foreach ($item in $data) {
        $name = $item.C  # 2. sayfadaki C sütunu adı
        if ($namesData.ContainsKey($name)) {
            $item | Add-Member -MemberType NoteProperty -Name "ValueFromSheet4" -Value $namesData[$name]
        }
    }

    # Veriyi CSV'ye kaydet
    $csvFilePath = "C:\dosya_yolu\yeni_dosya.csv"
    $data | Export-Csv -Path $csvFilePath -NoTypeInformation

} catch {
    Write-Error "Bir hata oluştu: $_"
} finally {
    $workbook.Close($false)
    $excel.Quit()
    [System.Runtime.Interopservices.Marshal]::ReleaseComObject($excel) | Out-Null
    [System.Runtime.Interopservices.Marshal]::ReleaseComObject($workbook) | Out-Null
    [System.Runtime.Interopservices.Marshal]::ReleaseComObject($worksheet2) | Out-Null
    [System.Runtime.Interopservices.Marshal]::ReleaseComObject($worksheet4) | Out-Null
}
