<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <title>Dinamik Hiyerarşik Tablo</title>
    <style>
      /* Mevcut CSS içeriği */
    </style>
  </head>
  <body>
    <h1>Dinamik Hiyerarşik Tablo</h1>

    <table id="hierarchy-table">
      <thead>
        <tr id="table-header"></tr>
      </thead>
      <tbody></tbody>
    </table>

    <div id="details" class="details-panel">
      <div class="details-title" id="details-title">Detay</div>
      <div class="details-content" id="details-content">
        Tıklanan satıra ait açıklama burada görünecek.
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        fetch("HierarchyTable.aspx")
          .then((response) => response.json())
          .then((data) => {
            const { latestData, historicData } = data;

            const tableHeadRow = document.getElementById("table-header");
            const tableBody = document.querySelector("#hierarchy-table tbody");
            const detailTitle = document.getElementById("details-title");
            const detailContent = document.getElementById("details-content");

            const columnHeaders = ["name", "amount", "created_at"];
            columnHeaders.forEach((key) => {
              const th = document.createElement("th");
              th.textContent = key.charAt(0).toUpperCase() + key.slice(1);
              tableHeadRow.appendChild(th);
            });

            function createTableRow(item, depth = 0) {
              const row = document.createElement("tr");
              row.classList.add(`indent-${depth}`);

              columnHeaders.forEach((key) => {
                const cell = document.createElement("td");
                cell.textContent = item[key] !== undefined ? item[key] : "";
                row.appendChild(cell);
              });

              row.addEventListener("click", () => {
                document
                  .querySelectorAll("tbody tr")
                  .forEach((r) => r.classList.remove("active"));
                row.classList.add("active");

                detailTitle.textContent = `Detay: ${item.name || "Bilinmiyor"}`;
                detailContent.textContent = columnHeaders
                  .map((key) => `${key}: ${item[key] ?? "-"}`)
                  .join("\n");
              });

              tableBody.appendChild(row);
            }

            latestData.forEach((item) => createTableRow(item));
          });
      });
    </script>
  </body>
</html>
