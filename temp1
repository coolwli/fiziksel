$vcenters = @("01", "02", "03", "04", "05", "06")

$vcenter = "01"
Connect-VIServer -Server $vcenter

$report = @()

$vcenterUsers = Get-VIPermission | Select-Object Principal, Role

$vcenterUsers | ForEach-Object {
    $report += [PSCustomObject]@{
        Domain    = $vcenter
        Principal  = $_.Principal
        Role       = $_.Role
        Inherited  = $false
    }
}

$clusters = Get-Cluster

foreach ($cluster in $clusters) {
    $clusterPermissions = Get-Cluster $cluster | Get-VIPermission
    foreach ($perm in $clusterPermissions) {
        $isInherited = ($perm.EntityId -ne $cluster.Id)

        $report += [PSCustomObject]@{
            Domain    = $cluster.Name
            Principal  = $perm.Principal
            Role       = $perm.Role
            Inherited  = $isInherited
        }
    }
}

Disconnect-VIServer -Server $vcenter -Confirm:$false
