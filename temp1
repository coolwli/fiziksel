private void SendUsageDataToClient(Dictionary<string, double[]> metricsData, DateTime[] timestamps)
{
    var scriptBuilder = new StringBuilder();

    // Convert timestamps to JavaScript date strings
    var timestampsJsArray = string.Join(",", timestamps.Select(t => $"\"{t:yyyy-MM-ddTHH:mm:ss}\""));

    scriptBuilder.AppendLine("let timestamps = [" + timestampsJsArray + "];");

    // Convert metrics data to JavaScript arrays
    foreach (var metric in metricsData)
    {
        string key = metric.Key.Replace("|", "_");
        string dataArray = string.Join(",", metric.Value.Select(v => v.ToString("F2")));
        scriptBuilder.AppendLine($"let {key}Data = [{dataArray}];");
    }

    // Call a JavaScript function to use the data
    scriptBuilder.AppendLine("processData(timestamps, { " +
                             string.Join(", ", metricsData.Keys.Select(k => $"{k.Replace("|", "_")}Data: {k.Replace("|", "_")}Data")) +
                             " });");

    // Register the script to be executed on the client side
    ClientScript.RegisterStartupScript(this.GetType(), "usageDataScript", scriptBuilder.ToString(), true);
}
