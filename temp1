private void SendUsageDataToClient(Dictionary<string, double[]> metricsData, DateTime[] timestamps)
{
    var scriptBuilder = new StringBuilder();
    scriptBuilder.AppendLine("let dates = [" + string.Join(",", timestamps.Select(t => $"\"{t:yyyy-MM-ddTHH:mm:ss}\"")) + "];");

    // Track which disk metrics have already been added
    var processedDiskMetrics = new HashSet<string>();

    foreach (var metric in metricsData)
    {
        string key = metric.Key.Replace("|", "").Replace(@"\", "_").Replace(":", "");
        string dataArray = string.Join(",", metric.Value.Select(v => v.ToString("F2")));
        scriptBuilder.AppendLine($"let {key}Data = [{dataArray}];");

        // If the metric is a disk metric and hasn't been processed yet, add it to diskDataMap
        if (metric.Key.StartsWith("guestfilesystem") && metric.Key.EndsWith("|percentage"))
        {
            if (!processedDiskMetrics.Contains(key))
            {
                string diskDataArray = string.Join(",", metric.Value.Select(v => v.ToString("F2")));
                scriptBuilder.AppendLine($"diskDataMap['{key}'] = [{diskDataArray}];");
                processedDiskMetrics.Add(key);
            }
        }
    }

    // Ensure diskDataMap is initialized
    scriptBuilder.AppendLine("let diskDataMap = diskDataMap || {};");

    // Output the script to the client
    ClientScript.RegisterStartupScript(this.GetType(), "usageDataScript", scriptBuilder.ToString(), true);
}
