<asp:ScriptManager ID="ScriptManager1" runat="server" />
<asp:UpdatePanel ID="UpdatePanel1" runat="server">
    <ContentTemplate>
        <asp:Panel ID="Panel1" runat="server">
            <asp:Label ID="lblServerName" runat="server" Text="Sunucu Adı: " />
            <asp:TextBox ID="txtServerName" runat="server" />

            <asp:Label ID="lblServerType" runat="server" Text=" Sunucu Tipi: " />
            <asp:DropDownList ID="ddlServerType" runat="server">
                <asp:ListItem Text="Windows" Value="Windows" />
                <asp:ListItem Text="Linux" Value="Linux" />
                <asp:ListItem Text="Appliance" Value="Appliance" />
                <asp:ListItem Text="ESXi" Value="ESXi" />
            </asp:DropDownList>

            <asp:Button ID="btnRunScript" runat="server" Text="İlişkilendir" OnClick="btnRunScript_Click"
                OnClientClick="return confirm('Emin misiniz?');" />
            <br />
            <asp:Label ID="lblResult" runat="server" ForeColor="Blue" />
        </asp:Panel>
    </ContentTemplate>
</asp:UpdatePanel>




using System;
using System.Diagnostics;

public partial class Default : System.Web.UI.Page
{
    protected void btnRunScript_Click(object sender, EventArgs e)
    {
        string serverName = txtServerName.Text.Trim();
        string serverType = ddlServerType.SelectedValue;

        if (string.IsNullOrEmpty(serverName))
        {
            lblResult.Text = "⚠️ Sunucu adı boş olamaz!";
            lblResult.ForeColor = System.Drawing.Color.Red;
            return;
        }

        string resultText;
        bool success = RunPowerShellScript(serverName, serverType, out resultText);

        lblResult.ForeColor = success ? System.Drawing.Color.Green : System.Drawing.Color.Red;
        lblResult.Text = success ? $"✅ İşlem başarılı: {resultText}" : $"❌ Hata: {resultText}";
    }

    private bool RunPowerShellScript(string serverName, string serverType, out string resultOutput)
    {
        resultOutput = "";
        try
        {
            var scriptPath = Server.MapPath("~/Scripts/RelationScript.ps1");
            var psi = new ProcessStartInfo()
            {
                FileName = "powershell.exe",
                Arguments = $"-NoProfile -ExecutionPolicy Bypass -File \"{scriptPath}\" -ServerName \"{serverName}\" -ServerType \"{serverType}\"",
                RedirectStandardOutput = true,
                RedirectStandardError = true,
                UseShellExecute = false,
                CreateNoWindow = true
            };

            using (var process = Process.Start(psi))
            {
                resultOutput = process.StandardOutput.ReadToEnd().Trim();
                string error = process.StandardError.ReadToEnd().Trim();
                process.WaitForExit();

                if (process.ExitCode == 0)
                    return true;
                else
                {
                    resultOutput += Environment.NewLine + error;
                    return false;
                }
            }
        }
        catch (Exception ex)
        {
            resultOutput = ex.Message;
            return false;
        }
    }
}
