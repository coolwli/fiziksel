using System;
using System.Web.UI.DataVisualization.Charting;
using System.IO;
using System.Collections.Generic;

namespace PieChartGenerator
{
    public partial class _Default : System.Web.UI.Page
    {
        protected void Page_Load(object sender, EventArgs e)
        {
        }

        protected void btnGenerate_Click(object sender, EventArgs e)
        {
            string[] inputLines = txtInput.Text.Split(new char[] { '\r', '\n' }, StringSplitOptions.RemoveEmptyEntries);

            Dictionary<string, int> valueCounts = new Dictionary<string, int>();

            foreach (string line in inputLines)
            {
                string[] parts = line.Split(',');
                if (parts.Length >= 2)
                {
                    double num;
                    if (double.TryParse(parts[0], out num))
                    {
                        string label = parts[1];
                        int value;
                        if (int.TryParse(parts[0], out value))
                        {
                            if (!valueCounts.ContainsKey(label))
                            {
                                valueCounts[label] = value;
                            }
                            else
                            {
                                valueCounts[label] += value;
                            }
                        }
                    }
                }
            }

            Chart chart = new Chart();
            chart.Width = 400;
            chart.Height = 300;

            ChartArea chartArea = new ChartArea();
            chart.ChartAreas.Add(chartArea);

            Series series = new Series();
            series.ChartType = SeriesChartType.Pie;

            foreach (var kvp in valueCounts)
            {
                DataPoint point = new DataPoint();
                point.SetValueY(kvp.Value);
                point.Label = $"{kvp.Key} ({kvp.Value})"; // Include count in the label
                series.Points.Add(point);
            }

            chart.Series.Add(series);

            Legend legend = new Legend();
            legend.Docking = Docking.Bottom;
            chart.Legends.Add(legend);

            string filePath = Server.MapPath("~/chartDemo.png");
            chart.SaveImage(filePath, ChartImageFormat.Png);

            ltChart.Text = "<img src='chartDemo.png' alt='Chart' />";
        }
    }
}
