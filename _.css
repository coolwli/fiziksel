using System;
using System.Collections.Generic;
using System.Text;
using System.Web.Script.Serialization;

public partial class Default : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        if (IsPostBack)
        {
            string jsonData = hiddenFieldData.Value;
            if (!string.IsNullOrEmpty(jsonData))
            {
                // JSON verisini dinamik olarak parçala
                JavaScriptSerializer js = new JavaScriptSerializer();
                var tableData = js.Deserialize<Dictionary<string, object>[]>(jsonData);

                // CSV verisini oluştur
                StringBuilder csv = new StringBuilder();
                csv.AppendLine("Name,Age,City"); // Başlık satırı

                foreach (var row in tableData)
                {
                    csv.AppendLine($"{row["name"]},{row["age"]},{row["city"]}");
                }

                // Kullanıcıya CSV dosyasını indirme imkanı sağla
                Response.Clear();
                Response.ContentType = "text/csv";
                Response.AddHeader("content-disposition", "attachment;filename=TableData.csv");
                Response.Write(csv.ToString());
                Response.End();
            }
        }
    }
}
