$conn = New-Object System.Data.SqlClient.SqlConnection "Data Source=TEKSCR1\SQLEXPRESS;Database=CloudUnited;Integrated Security=True"
$conn.Open()
$command = $conn.CreateCommand()

$queries = @(
    "DELETE FROM vminfoVMs",
    "DELETE FROM vminfoHosts",
    "DELETE FROM vminfoClusters"
)

$command.CommandText = $queries
$command.ExecuteNonQuery()

$conn.Close()

Start-Process powershell.exe -ArgumentList "-File F:\Ali\powershell\vmpedia\vmpediaHosts.ps1" -WindowStyle Hidden
Start-Process powershell.exe -ArgumentList "-File F:\Ali\powershell\vmpedia\vmpediaClusters.ps1" -WindowStyle Hidden

# Bir liste oluşturun
$processes = @()

# For döngüsünde tüm işlemleri başlatın ve her işlemi diziye ekleyin
for ($i = 0; $i -lt 10; $i++) {
    $process = Start-Process powershell.exe -ArgumentList "-File F:\Ali\powershell\vmpedia\vmpediaVMs.ps1 -start $($i)" -WindowStyle Hidden -PassThru
    $processes += $process
}

# Tüm süreçlerin bitmesini bekleyin
$processes | ForEach-Object {
    Wait-Process -Id $_.Id
}

Write-Host "All scripts have completed."
