function Summarize-MetricData {
    param([double[]]$Values, [string]$Category, [string]$MetricKey)

    if ($Values.Count -eq 0) {
        return @{
            unit = Get-MetricUnit -MetricKey $MetricKey
            samples = 0
            statistical_summary = @{
                mean = 0
                max = 0
                percentile_95 = 0
                percentile_99 = 0
                standard_deviation = 0
            }
            trend_analysis = @{
                trend_slope = 0
                trend_r_squared = 0
                trend_direction = "no_data"
            }
            threshold_pressure_analysis = @{}
            anomaly_detection = @{
                high_value_peak_count = 0
                total_anomaly_count = 0
                max_peak_value = 0
            }
        }
    }

    # Basic statistics
    $stats = $Values | Measure-Object -Average -Maximum
    $mean = [math]::Round($stats.Average, 2)
    $max = [math]::Round($stats.Maximum, 2)
    $p95 = [math]::Round((Get-Percentile -Values $Values -Percentile 95), 2)
    $p99 = [math]::Round((Get-Percentile -Values $Values -Percentile 99), 2)
    $std = [math]::Round((Get-StandardDeviation -Values $Values), 2)

    # Trend analysis
    $trend = Get-TrendAnalysis -Values $Values

    # Thresholds based on percentiles
    $percentileThresholds = @{
        "p70" = Get-Percentile -Values $Values -Percentile 70
        "p85" = Get-Percentile -Values $Values -Percentile 85
        "p95" = Get-Percentile -Values $Values -Percentile 95
    }
    $pressureRaw = Get-ThresholdAnalysis -Values $Values -Thresholds $percentileThresholds

    # Rename keys for readability
    $pressure = @{}
    foreach ($key in $pressureRaw.Keys) {
        if ($key -like "time_above_p*") {
            $newKey = "samples_above_percentile_$($key.Substring(12))"
            $pressure[$newKey] = $pressureRaw[$key]
        } elseif ($key -like "longest_run_p*") {
            $newKey = "longest_streak_above_percentile_$($key.Substring(14))"
            $pressure[$newKey] = $pressureRaw[$key]
        }
    }

    # Anomaly detection
    $anomalies = Get-AnomalyDetection -Values $Values

    return @{
        unit = Get-MetricUnit -MetricKey $MetricKey
        samples = $Values.Count
        statistical_summary = @{
            mean = $mean
            max = $max
            percentile_95 = $p95
            percentile_99 = $p99
            standard_deviation = $std
        }
        trend_analysis = @{
            trend_slope = $trend.slope
            trend_r_squared = $trend.r2
            trend_direction = $trend.trend
        }
        threshold_pressure_analysis = $pressure
        anomaly_detection = @{
            high_value_peak_count = $anomalies.peak_count
            total_anomaly_count = $anomalies.anomaly_count
            max_peak_value = $anomalies.max_peak_value
        }
    }
}
