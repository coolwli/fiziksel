# ODP.NET DLL'inin yolu
# Bu yolu, indirdiğiniz Instant Client paketindeki Oracle.ManagedDataAccess.dll'in gerçek yolu ile değiştirin.
$ODPNetDLLPath = "C:\Oracle\InstantClient_19_3\odp.net\managed\common\Oracle.ManagedDataAccess.dll"

# DLL'i yüklüyoruz
Add-Type -Path $ODPNetDLLPath

# Diğer bağlantı bilgileri ve sorgu kısmı aynı kalır
$Username = "VERITABANI_KULLANICI_ADI"
$Password = "VERITABANI_SIFRENIZ"
$DataSource = "VERITABANI_ADIM" # tnsnames.ora dosyasındaki takma ad

try {
    $conn = New-Object Oracle.ManagedDataAccess.Client.OracleConnection
    $conn.ConnectionString = "User Id=$Username;Password=$Password;Data Source=$DataSource;"
    $conn.Open()
    Write-Host "Oracle veritabanına başarıyla bağlandı!"

    $query = "SELECT * FROM SENIN_TABLO_ADIN WHERE ROWNUM <= 10"
    $cmd = New-Object Oracle.ManagedDataAccess.Client.OracleCommand($query, $conn)

    $reader = $cmd.ExecuteReader()

    $data = @()
    while ($reader.Read()) {
        $row = New-Object PSObject
        for ($i = 0; $i -lt $reader.FieldCount; $i++) {
            $columnName = $reader.GetName($i)
            $columnValue = $reader.GetValue($i)
            $row | Add-Member -MemberType NoteProperty -Name $columnName -Value $columnValue
        }
        $data += $row
    }

    $reader.Close()
    $cmd.Dispose()

    $data | Out-GridView -Title "Oracle Tablo Verileri"

}
catch [Oracle.ManagedDataAccess.Client.OracleException] {
    Write-Error "Oracle hatası oluştu: $($_.Exception.Message)"
}
catch {
    Write-Error "Beklenmeyen bir hata oluştu: $($_.Exception.Message)"
}
finally {
    if ($conn.State -eq 'Open') {
        $conn.Close()
        Write-Host "Veritabanı bağlantısı kapatıldı."
    }
}
