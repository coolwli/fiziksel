private Tuple<Dictionary<string, double[]>, DateTime[]> ParseMetricsData(string xmlData)
{
    var metricsData = new Dictionary<string, List<double>>();
    List<DateTime> timestamps = new List<DateTime>();

    using (var stringReader = new StringReader(xmlData))
    using (var xmlReader = XmlReader.Create(stringReader))
    {
        string currentMetricName = null;
        List<double> currentDataList = null;
        
        while (xmlReader.Read())
        {
            if (xmlReader.NodeType == XmlNodeType.Element)
            {
                switch (xmlReader.LocalName)
                {
                    case "stat":
                        // Initialize the metric data list if a new stat is encountered
                        currentMetricName = null;
                        currentDataList = null;
                        break;

                    case "statKey":
                        // Extract the metric name
                        if (xmlReader.ReadToDescendant("key"))
                        {
                            currentMetricName = xmlReader.ReadElementContentAsString().Trim();
                            
                            // Check if the metric should be included
                            if (_metricsToFilter.Contains(currentMetricName))
                            {
                                if (!metricsData.ContainsKey(currentMetricName))
                                {
                                    metricsData[currentMetricName] = new List<double>();
                                }
                                currentDataList = metricsData[currentMetricName];
                            }
                        }
                        break;

                    case "data":
                        // Extract the metric data if the current data list is valid
                        if (currentDataList != null)
                        {
                            string dataContent = xmlReader.ReadElementContentAsString().Trim();
                            var dataValues = dataContent.Split(new[] { ' ' }, StringSplitOptions.RemoveEmptyEntries);

                            foreach (var value in dataValues)
                            {
                                if (double.TryParse(value, out double result))
                                {
                                    currentDataList.Add(result);
                                }
                            }
                        }
                        break;

                    case "timestamps":
                        // Extract timestamps if we encounter this element
                        if (xmlReader.Read())
                        {
                            var timestampContent = xmlReader.ReadElementContentAsString().Trim();
                            long timestampMillis;
                            if (long.TryParse(timestampContent, out timestampMillis))
                            {
                                // Convert from milliseconds since epoch to DateTime
                                DateTime timestamp = DateTimeOffset.FromUnixTimeMilliseconds(timestampMillis).DateTime;
                                timestamps.Add(timestamp);
                            }
                        }
                        break;
                }
            }
        }
    }

    // Convert metrics data to arrays
    var metricsDataArray = metricsData.ToDictionary(
        kvp => kvp.Key,
        kvp => kvp.Value.ToArray()
    );

    // Convert timestamps to array
    var timestampsArray = timestamps.ToArray();

    return new Tuple<Dictionary<string, double[]>, DateTime[]>(metricsDataArray, timestampsArray);
}
