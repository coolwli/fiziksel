<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Charts with Table</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
        }

        .panel-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: space-between;
        }

        .chart-table-wrapper {
            display: flex;
            width: 100%;
        }

        .panel {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            padding: 15px;
            width: 80%;
            min-width: 300px;
        }

        .table-container {
            width: 20%;
            padding-left: 20px;
        }

        canvas {
            width: 100%;
            height: 250px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
            border-radius: 8px;
            max-height: 500px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        table th,
        table td {
            padding: 12px;
            border: none;
            text-align: center;
            transition: background-color 0.3s;
        }

        table th {
            background-color: #6d6d6d;
            color: white;
            font-weight: bold;
        }

        table tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        table tr:hover {
            background-color: #f1f1f1;
        }

        .chart-container {
            margin-bottom: 20px;
        }

        .date-selector {
            margin-bottom: 20px;
        }
    </style>
</head>

<body>

    <div class="date-selector">
        <label for="start-date">Başlangıç Tarihi:</label>
        <input type="date" id="start-date">
        <label for="end-date">Bitiş Tarihi:</label>
        <input type="date" id="end-date">
        <button id="filter-button">Filtrele</button>
    </div>

    <div id="chart-tables" class="panel-container"></div>

    <script>
        const totalDays = 30; // Toplam gün sayısı
        const generatedDates = generateDates('2023-01-01', totalDays);
        let chartData = fetchData();

        const generateDates = (startDate, days) => {
            const dates = [];
            const date = new Date(startDate);
            for (let i = 0; i < days; i++) {
                const nextDate = new Date(date);
                nextDate.setDate(date.getDate() + i);
                dates.push(nextDate.toISOString().split('T')[0]);
            }
            return dates;
        };

        const generateDynamicData = () => {
            return [
                {
                    label: 'Dataset A',
                    data: Array.from({ length: totalDays }, () => Math.floor(Math.random() * 100)),
                },
                {
                    label: 'Dataset B',
                    data: Array.from({ length: totalDays }, () => Math.floor(Math.random() * 100)),
                },
                {
                    label: 'Dataset C',
                    data: Array.from({ length: totalDays }, () => Math.floor(Math.random() * 100)),
                }
            ];
        };

        const getRandomColor = () => {
            const r = Math.floor(Math.random() * 255);
            const g = Math.floor(Math.random() * 255);
            const b = Math.floor(Math.random() * 255);
            return {
                borderColor: `rgba(${r}, ${g}, ${b}, 1)`,
                backgroundColor: `rgba(${r}, ${g}, ${b}, 0.2)`
            };
        };

        const createChart = (ctx, datasets, dates, chartTitle) => {
            return new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: datasets.map((dataset) => {
                        const colors = getRandomColor();
                        return {
                            label: dataset.label,
                            data: dataset.data.map((y, i) => ({ x: dates[i], y })),
                            borderColor: colors.borderColor,
                            backgroundColor: colors.backgroundColor,
                            borderWidth: 2,
                            tension: 0.1,
                            pointRadius: 3,
                            fill: false
                        };
                    })
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: chartTitle
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    },
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'day'
                            },
                            title: {
                                display: true,
                                text: 'Date'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Value'
                            }
                        }
                    }
                }
            });
        };

        const createTable = (datasets, dates) => {
            let table = `<table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>First Day</th>
                        <th>Last Day</th>
                    </tr>
                </thead>
                <tbody>`;
            datasets.forEach((dataset) => {
                const firstValue = dataset.data[0];
                const lastValue = dataset.data[dataset.data.length - 1];
                table += `
                    <tr>
                        <td>${dataset.label}</td>
                        <td>${firstValue}</td>
                        <td>${lastValue}</td>
                    </tr>`;
            });
            table += `</tbody></table>`;
            return table;
        };

        const initializeChartsAndTables = (data, startDate, endDate) => {
            const chartTablesContainer = document.getElementById('chart-tables');
            chartTablesContainer.innerHTML = '';

            const filteredDates = generatedDates.filter(date => date >= startDate && date <= endDate);

            data.forEach((datasetGroup, index) => {
                const wrapper = document.createElement('div');
                wrapper.classList.add('chart-table-wrapper');

                const panel = document.createElement('div');
                panel.classList.add('panel');

                const chartContainer = document.createElement('div');
                chartContainer.classList.add('chart-container');
                const tableContainer = document.createElement('div');
                tableContainer.classList.add('table-container');

                chartContainer.innerHTML = `<canvas id="chart${index}"></canvas>`;
                tableContainer.innerHTML = createTable(datasetGroup.datasets, filteredDates);

                panel.appendChild(chartContainer);
                wrapper.appendChild(panel);
                wrapper.appendChild(tableContainer);
                chartTablesContainer.appendChild(wrapper);

                const ctx = document.getElementById(`chart${index}`).getContext('2d');
                const chartTitle = datasetGroup.title;

                createChart(ctx, datasetGroup.datasets, filteredDates, chartTitle);
            });
        };

        const fetchData = () => {
            return [
                {
                    title: "Money Chart",
                    datasets: generateDynamicData()
                },
                {
                    title: "Age Chart",
                    datasets: generateDynamicData()
                },
                {
                    title: "Temperature Chart",
                    datasets: generateDynamicData()
                }
            ];
        };

        const handleFilterClick = () => {
            const startDate = document.getElementById('start-date').value;
            const endDate = document.getElementById('end-date').value;

            if (startDate && endDate) {
                initializeChartsAndTables(chartData, startDate, endDate);
            } else {
                alert('Lütfen başlangıç ve bitiş tarihlerini seçin.');
            }
        };

        // Sayfa yüklendiğinde tarih alanlarını otomatik doldur
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('start-date').value = generatedDates[0];
        document.getElementById('end-date').value = generatedDates[generatedDates.length - 1];

        document.getElementById('filter-button').addEventListener('click', handleFilterClick);

        // Başlangıçta grafik ve tablo oluştur
        initializeChartsAndTables(chartData, generatedDates[0], generatedDates[generatedDates.length - 1]);
    </script>

</body>

</html>
