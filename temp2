$conn = New-Object System.Data.SqlClient.SqlConnection "Data Source=TEKSCR1\SQLEXPRESS;Database=CloudUnited;Integrated Security=True"
$conn.Open()
$command = $conn.CreateCommand()
$check="DELETE FROM VMInfos2"
$command.CommandText = $check
$command.ExecuteNonQuery()
$check="DELETE FROM VMHostInfos"
$command.CommandText = $check
$command.ExecuteNonQuery()
$check="DELETE FROM ClusterInfos"
$command.CommandText = $check
$command.ExecuteNonQuery()

Start-Process powershell.exe -ArgumentList "-File F:\Ali\powershell\vminfo\clusterInfosSavingSql.ps1" -NoNewWindow
Start-Process powershell.exe -ArgumentList "-File F:\Ali\powershell\vminfo\vmhostInfosSavingSql.ps1" -NoNewWindow
for($i=0;$i -le 5;$i++){
    Start-Process powershell.exe -ArgumentList "-File F:\Ali\powershell\vminfo\vmInfosSavingSql.ps1 -start $($i*2000)" -NoNewWindow
}
$check="UPDATE VMInfos2
SET VMCreatedDate = VMsExtras.CreatedDate
FROM VMInfos2
JOIN VMsExtras ON VMInfos2.VMName =VMsExtras.VMName
WHERE VMCreatedDate = 'NULL';

UPDATE VMInfos2
SET VMCreatedDate = '-'
WHERE VMCreatedDate = 'NULL';

UPDATE VMInfos2
SET VMOwner = '-'
WHERE VMOwner IS NULL;"
$command.CommandText = $check
$command.ExecuteNonQuery()
$conn.Close()

 
